@page
@model DbSync.Web.Pages.Usuarios.IndexModel
@{
    ViewData["Title"] = "Usuarios";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0"><i class="bi bi-people-fill"></i> Usuarios</h2>
    <a href="/Usuarios/Edit" class="btn btn-primary btn-sm">
        <i class="bi bi-plus-lg"></i> Nuevo Usuario
    </a>
</div>

<div class="card">
    <div class="card-body p-0">
        <div class="table-search-bar">
            <span class="search-count" data-search-count="tblUsuarios">@Model.Usuarios.Count registros</span>
            <input type="text" class="form-control form-control-sm" data-table-search="tblUsuarios" placeholder="Buscar..." />
        </div>
        <table id="tblUsuarios" class="table table-hover table-sm mb-0 sortable-table">
            <thead class="table-light">
                <tr>
                    <th>Usuario</th>
                    <th>Nombre</th>
                    <th>Email</th>
                    <th>Rol</th>
                    <th>Clientes</th>
                    <th>Estado</th>
                    <th data-no-sort></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var u in Model.Usuarios)
                {
                    var roleBadge = u.Roles.FirstOrDefault() switch
                    {
                        "Admin" => "bg-danger",
                        "DBA" => "bg-warning text-dark",
                        _ => "bg-info"
                    };
                    <tr>
                        <td><code>@u.UserName</code></td>
                        <td>@u.NombreCompleto</td>
                        <td>@u.Email</td>
                        <td><span class="badge @roleBadge">@(u.Roles.FirstOrDefault() ?? "Sin rol")</span></td>
                        <td>
                            @if (u.Roles.Contains("Admin"))
                            {
                                <span class="text-muted small">Todos</span>
                            }
                            else if (u.ClientesAsignados.Any())
                            {
                                @foreach (var c in u.ClientesAsignados)
                                {
                                    <span class="badge bg-light text-dark me-1">@c</span>
                                }
                            }
                            else
                            {
                                <span class="text-muted small">Ninguno</span>
                            }
                        </td>
                        <td>
                            @if (u.Activo)
                            {
                                <i class="bi bi-check-circle text-success"></i>
                            }
                            else
                            {
                                <i class="bi bi-x-circle text-danger"></i>
                            }
                        </td>
                        <td>
                            <a href="/Usuarios/Edit?id=@u.Id" class="btn btn-outline-primary btn-sm py-0">
                                <i class="bi bi-pencil"></i>
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
