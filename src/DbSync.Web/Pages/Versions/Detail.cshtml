@page
@model DbSync.Web.Pages.Versions.DetailModel
@{
    ViewData["Title"] = "Detalle de Versión";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2><i class="bi bi-file-code"></i> Versión @Model.Version?.VersionNumber</h2>
    <a href="/Versions?clienteId=@Model.ClienteId&ambiente=@Model.Ambiente&objeto=@Model.Version?.FullName"
       class="btn btn-outline-secondary btn-sm">
        <i class="bi bi-arrow-left"></i> Volver
    </a>
</div>

@if (!string.IsNullOrEmpty(Model.ErrorMessage))
{
    <div class="alert alert-danger">@Model.ErrorMessage</div>
}

@if (Model.Version != null)
{
    <div class="card mb-3">
        <div class="card-body">
            <div class="row">
                <div class="col-md-3">
                    <strong>Objeto:</strong>
                    @{
                        var detailBadgeClass = Model.Version.ObjectType switch
                        {
                            "PROCEDURE" => "bg-primary",
                            "VIEW" => "bg-info",
                            "FUNCTION" => "bg-success",
                            _ => "bg-secondary"
                        };
                    }
                    <span class="badge @detailBadgeClass">@Model.Version.ShortType</span>
                    <code>@Model.Version.FullName</code>
                </div>
                <div class="col-md-2"><strong>Base:</strong> @Model.Version.DatabaseName</div>
                <div class="col-md-2"><strong>Evento:</strong>
                    <span class="badge @(Model.Version.EventType.Contains("DROP") ? "bg-danger" : Model.Version.EventType.Contains("CREATE") ? "bg-success" : "bg-warning text-dark")">
                        @Model.Version.EventType
                    </span>
                </div>
                <div class="col-md-2"><strong>Usuario:</strong> @Model.Version.ModifiedBy</div>
                <div class="col-md-3"><strong>Fecha:</strong> @Model.Version.ModifiedDate.ToString("dd/MM/yyyy HH:mm:ss")</div>
            </div>
            @if (Model.Version.HostName != null)
            {
                <div class="row mt-1">
                    <div class="col-md-3"><strong>Host:</strong> @Model.Version.HostName</div>
                    <div class="col-md-3"><strong>Aplicación:</strong> @Model.Version.ApplicationName</div>
                </div>
            }
        </div>
    </div>

    <div class="card">
        <div class="card-header d-flex justify-content-between">
            <span>Definición (v@(Model.Version.VersionNumber))</span>
            <button class="btn btn-sm btn-outline-secondary" onclick="copyDefinition()">
                <i class="bi bi-clipboard"></i> Copiar
            </button>
        </div>
        <div class="card-body p-0">
            <pre id="definitionCode" class="p-3 m-0" style="max-height: 75vh; overflow: auto; background: #f8f9fa; font-size: 0.85rem;">@Model.Version.ObjectDefinition</pre>
        </div>
    </div>
}

@section Scripts {
<script>
    function copyDefinition() {
        var text = document.getElementById('definitionCode').textContent;
        navigator.clipboard.writeText(text).then(function() {
            alert('Definición copiada al portapapeles');
        });
    }
</script>
}
